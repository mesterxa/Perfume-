<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ - Ø¹Ø·ÙˆØ± Ø§Ù„Ù†Ø®Ø¨Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #d4af37; --bg: #0f172a; --danger: #ef4444; }
        body { margin: 0; font-family: 'Cairo', sans-serif; background: var(--bg); color: white; }
        header { background: #111827; padding: 15px 5%; display: flex; justify-content: space-between; border-bottom: 1px solid var(--gold); }
        .container { padding: 20px; max-width: 600px; margin: auto; }
        .card { background: #1f2937; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        input, select, textarea { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #374151; background: #111827; color: white; font-family: inherit; }
        .btn-save { width: 100%; padding: 15px; border-radius: 10px; border: none; background: var(--danger); color: white; font-weight: bold; cursor: pointer; font-size: 1.1rem; transition: 0.3s; }
        .btn-save:hover { filter: brightness(1.2); }
        .expense-item { background: #2d3748; padding: 15px; border-radius: 10px; margin-top: 10px; display: flex; justify-content: space-between; align-items: center; border-right: 4px solid var(--danger); }
    </style>
</head>
<body>

<header>
    <span style="color:var(--gold); font-weight: bold;">ğŸ“‰ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</span>
    <button onclick="location.href='index.html'" style="background:none; border:1px solid white; color:white; padding:5px 15px; border-radius:8px; cursor:pointer;">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
</header>

<div class="container">
    <div class="card">
        <h3>â• Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯</h3>
        <select id="expType">
            <option value="Ø¥ÙŠØ¬Ø§Ø±">Ø¥ÙŠØ¬Ø§Ø±</option>
            <option value="ÙƒÙ‡Ø±Ø¨Ø§Ø¡/Ù…Ø§Ø¡">ÙƒÙ‡Ø±Ø¨Ø§Ø¡/Ù…Ø§Ø¡</option>
            <option value="Ø±ÙˆØ§ØªØ¨">Ø±ÙˆØ§ØªØ¨</option>
            <option value="Ø¯Ø¹Ø§ÙŠØ© ÙˆØ¥Ø¹Ù„Ø§Ù†">Ø¯Ø¹Ø§ÙŠØ© ÙˆØ¥Ø¹Ù„Ø§Ù†</option>
            <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
        </select>
        <input type="number" id="expAmount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº (Ø±ÙŠØ§Ù„)">
        <textarea id="expNote" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©..." rows="2"></textarea>
        <button class="btn-save" id="saveExp">Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙ</button>
    </div>

    <h3 style="margin-top: 30px; color: var(--gold);">ğŸ“‹ Ø¢Ø®Ø± Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h3>
    <div id="expensesList">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
</div>

<script type="module">
    import { db } from "./firebase-config.js";
    import { collection, addDoc, onSnapshot, query, orderBy, limit, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ
    document.getElementById("saveExp").onclick = async () => {
        const amount = Number(document.getElementById("expAmount").value);
        const type = document.getElementById("expType").value;
        const note = document.getElementById("expNote").value;

        if (!amount || amount <= 0) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­");

        try {
            await addDoc(collection(db, "expenses"), {
                type: type,
                amount: amount,
                note: note,
                date: new Date()
            });
            document.getElementById("expAmount").value = "";
            document.getElementById("expNote").value = "";
            alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙ Ø¨Ù†Ø¬Ø§Ø­");
        } catch (e) {
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª");
        }
    };

    // Ø¹Ø±Ø¶ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ù„Ø­Ø¸ÙŠØ§Ù‹
    const q = query(collection(db, "expenses"), orderBy("date", "desc"), limit(10));
    onSnapshot(q, (snap) => {
        const list = document.getElementById("expensesList");
        list.innerHTML = "";
        snap.forEach(s => {
            const exp = s.data();
            list.innerHTML += `
                <div class="expense-item">
                    <div>
                        <strong>${exp.type}</strong> - <span style="color:var(--danger)">${exp.amount} Ø±ÙŠØ§Ù„</span><br>
                        <small style="color:#aaa">${exp.note || ''}</small>
                    </div>
                    <button onclick="deleteExp('${s.id}')" style="background:none; border:none; color:#ff4d4d; cursor:pointer;">ğŸ—‘ï¸</button>
                </div>
            `;
        });
    });

    window.deleteExp = async (id) => {
        if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ØµØ±ÙˆÙØŸ")) {
            await deleteDoc(doc(db, "expenses", id));
        }
    };
</script>
</body>
</html>
